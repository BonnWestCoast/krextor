<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><title>XML source view</title><link rel="stylesheet" type="text/css" href="../xmlverbatim.css"></link></head><body class="xmlverb-default"><tt>
<!-- converted by xmlverbatim.xsl 1.1, (c) O. Becker -->
<div xmlns:xd="http://www.pnp-software.com/XSLTdoc" class="xmlverb-default">&lt;!--<span class="xmlverb-comment"><br></br>
    *  Copyright (C) 2008<br></br>
    *  Christoph Lange<br></br>
    *  Gordan Ristovski<br></br>
    *  Andrei Ioniţă<br></br>
    *  KWARC, Jacobs University Bremen<br></br>
    *  http://kwarc.info/projects/krextor/<br></br>
    *<br></br>
    *   Krextor is free software; you can redistribute it and/or<br></br>
    *         modify it under the terms of the GNU Lesser General Public<br></br>
    *         License as published by the Free Software Foundation; either<br></br>
    *         version 2 of the License, or (at your option) any later version.<br></br>
    *<br></br>
    *         This program is distributed in the hope that it will be useful,<br></br>
    *         but WITHOUT ANY WARRANTY; without even the implied warranty of<br></br>
    *         MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU<br></br>
    *         Lesser General Public License for more details.<br></br>
    *<br></br>
    *         You should have received a copy of the GNU Lesser General Public<br></br>
    *         License along with this library; if not, write to the<br></br>
    *         Free Software Foundation, Inc., 59 Temple Place - Suite 330,<br></br>
    *         Boston, MA 02111-1307, USA.<br></br>
    * <br></br>
</span>--&gt;<br></br>
&lt;<span class="xmlverb-element-name"><a name="d43e2">stylesheet</a></span><span class="xmlverb-ns-name"> xmlns:omdoc</span>="<span class="xmlverb-ns-uri">http://omdoc.org/ns</span>"<span class="xmlverb-ns-name"> xmlns</span>="<span class="xmlverb-ns-uri">http://www.w3.org/1999/XSL/Transform</span>"<span class="xmlverb-ns-name"> xmlns:xs</span>="<span class="xmlverb-ns-uri">http://www.w3.org/2001/XMLSchema</span>"<span class="xmlverb-ns-name"> xmlns:om</span>="<span class="xmlverb-ns-uri">http://www.openmath.org/OpenMath</span>"<span class="xmlverb-ns-name"> xmlns:xd</span>="<span class="xmlverb-ns-uri">http://www.pnp-software.com/XSLTdoc</span>"<span class="xmlverb-ns-name"> xmlns:krextor</span>="<span class="xmlverb-ns-uri">http://kwarc.info/projects/krextor</span>"<span class="xmlverb-ns-name"> xmlns:m</span>="<span class="xmlverb-ns-uri">http://www.w3.org/1998/Math/MathML</span>" <span class="xmlverb-attr-name">xpath-default-namespace</span>="<span class="xmlverb-attr-content">http://omdoc.org/ns</span>" <span class="xmlverb-attr-name">exclude-result-prefixes</span>="<span class="xmlverb-attr-content">#all</span>" <span class="xmlverb-attr-name">version</span>="<span class="xmlverb-attr-content">2.0</span>"&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e4">include</a></span> <span class="xmlverb-attr-name">href</span>="<span class="xmlverb-attr-content">util/omdoc.xsl</span>" /&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span><div class="xd">

    &lt;<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name"><a name="d43e6">doc</a></span> <span class="xmlverb-attr-name">type</span>="<span class="xmlverb-attr-content">stylesheet</span>"&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name"><a name="d43e8">short</a></span>&gt;<span class="xmlverb-text">Extraction module for </span>&lt;<span class="xmlverb-element-name"><a name="d43e10">a</a></span> <span class="xmlverb-attr-name">href</span>="<span class="xmlverb-attr-content">http://www.omdoc.org</span>"&gt;<span class="xmlverb-text">OMDoc</span>&lt;/<span class="xmlverb-element-name">a</span>&gt;&lt;/<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name">short</span>&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name"><a name="d43e13">detail</a></span>&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e15">p</a></span>&gt;<span class="xmlverb-text">This stylesheet extracts RDF from </span>&lt;<span class="xmlverb-element-name"><a name="d43e17">a</a></span> <span class="xmlverb-attr-name">href</span>="<span class="xmlverb-attr-content">http://www.omdoc.org</span>"&gt;<span class="xmlverb-text">OpenMath</span>&lt;/<span class="xmlverb-element-name">a</span>&gt;<span class="xmlverb-text"> content dictionaries (CDs).</span>&lt;/<span class="xmlverb-element-name">p</span>&gt;<span class="xmlverb-text">  <br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e21">p</a></span>&gt;<span class="xmlverb-text">Existing metadata vocabularies are reused, as documented here or in the ontology.</span>&lt;/<span class="xmlverb-element-name">p</span>&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e24">p</a></span>&gt;<span class="xmlverb-text">See </span>&lt;<span class="xmlverb-element-name"><a name="d43e26">a</a></span> <span class="xmlverb-attr-name">href</span>="<span class="xmlverb-attr-content">http://omdoc.org/ontology#</span>"&gt;<span class="xmlverb-text">http://omdoc.org/ontology#</span>&lt;/<span class="xmlverb-element-name">a</span>&gt;<span class="xmlverb-text"> or the sources at </span>&lt;<span class="xmlverb-element-name"><a name="d43e29">a</a></span> <span class="xmlverb-attr-name">href</span>="<span class="xmlverb-attr-content">https://svn.omdoc.org/repos/omdoc/trunk/owl</span>"&gt;<span class="xmlverb-text">https://svn.omdoc.org/repos/omdoc/trunk/owl</span>&lt;/<span class="xmlverb-element-name">a</span>&gt;<span class="xmlverb-text"> for the corresponding ontology.</span>&lt;/<span class="xmlverb-element-name">p</span>&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;/<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name">detail</span>&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name"><a name="d43e34">author</a></span>&gt;<span class="xmlverb-text">Christoph Lange</span>&lt;/<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name">author</span>&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name"><a name="d43e37">copyright</a></span>&gt;<span class="xmlverb-text">Christoph Lange, 2008–2010</span>&lt;/<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name">copyright</span>&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name"><a name="d43e40">svnId</a></span>&gt;<span class="xmlverb-text">$Id: omdoc.xsl 1995 2011-05-26 19:23:51Z clange $</span>&lt;/<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name">svnId</span>&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;/<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name">doc</span>&gt;</div><span class="xmlverb-text"><br></br>
    <br></br>
    </span>&lt;!--<span class="xmlverb-comment"> Note that this is not the global default; actually the <br></br>
         concrete way of URI generation is decided on element level </span>--&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e46">param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">autogenerate-fragment-uris</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'xml-id', 'document-root-base'</span>" /&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span>&lt;!--<span class="xmlverb-comment"> Other settings for testing </span>--&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;!--<span class="xmlverb-comment"><br></br>
    &lt;param name="autogenerate-fragment-uris" select="<br></br>
        'pseudo-xpath'<br></br>
        "/&gt;<br></br>
    </span>--&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e53">param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">use-root-xmlid</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">false()</span>" /&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span><div class="xd">

    &lt;<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name"><a name="d43e55">doc</a></span>&gt;<span class="xmlverb-text">Generate RDF for the document structure, in terms of the SALT document ontology?  Experimental feature.</span>&lt;/<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name">doc</span>&gt;</div><span class="xmlverb-text"><br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e58">param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">use-document-ontology</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">false()</span>" /&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e60">include</a></span> <span class="xmlverb-attr-name">href</span>="<span class="xmlverb-attr-content">util/openmath.xsl</span>" /&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e62">template</a></span> <span class="xmlverb-attr-name">match</span>="<span class="xmlverb-attr-content">node()</span>" <span class="xmlverb-attr-name">mode</span>="<span class="xmlverb-attr-content">krextor:uri-generation-method</span>"&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e64">param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">mmt</span>" <span class="xmlverb-attr-name">tunnel</span>="<span class="xmlverb-attr-content">yes</span>" /&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e66">sequence</a></span> <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">if ($mmt and @name) then ('mmt', $autogenerate-fragment-uris) else $autogenerate-fragment-uris</span>" /&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;/<span class="xmlverb-element-name">template</span>&gt;<span class="xmlverb-text"><br></br>
        <br></br>
    </span><div class="xd">

    &lt;<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name"><a name="d43e69">doc</a></span>&gt;<span class="xmlverb-text">“Overridden” OMDoc-specific variant of </span>&lt;<span class="xmlverb-element-name"><a name="d43e71">i</a></span>&gt;<span class="xmlverb-text">krextor:create-resource</span>&lt;/<span class="xmlverb-element-name">i</span>&gt;<span class="xmlverb-text">, keeps track of a few OMDoc structures and notions that affect many OMDoc elements<br></br>
        </span>&lt;<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name"><a name="d43e74">param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">formality-degree</span>" <span class="xmlverb-attr-name">type</span>="<span class="xmlverb-attr-content">string</span>"&gt;<span class="xmlverb-text">the URI of a formality degree from the ontology</span>&lt;/<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name">param</span>&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name"><a name="d43e77">param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">document-base</span>"&gt;<span class="xmlverb-text">the URI of the current document section resource *tunneled)</span>&lt;/<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name">param</span>&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name"><a name="d43e80">param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">knowledge-base</span>"&gt;<span class="xmlverb-text">the URI of the current mathematical or rhetorical structure (tunneled)</span>&lt;/<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name">param</span>&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name"><a name="d43e83">param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">ontologies</span>" <span class="xmlverb-attr-name">type</span>="<span class="xmlverb-attr-content">string*</span>"&gt;<span class="xmlverb-text">a list of values from ('document', 'knowledge'), specifying whether a document section or a mathematical/rhetorical structure resource should be generated from this element</span>&lt;/<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name">param</span>&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;/<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name">doc</span>&gt;</div><span class="xmlverb-text"><br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e88">template</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">krextor:create-omdoc-resource</span>"&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e90">param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">type</span>" /&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e92">param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">formality-degree</span>" /&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e94">param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">properties</span>" /&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e96">param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">subject-uri</span>" <span class="xmlverb-attr-name">as</span>="<span class="xmlverb-attr-content">xs:anyURI</span>" <span class="xmlverb-attr-name">tunnel</span>="<span class="xmlverb-attr-content">yes</span>" /&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e98">param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">document-base</span>" <span class="xmlverb-attr-name">tunnel</span>="<span class="xmlverb-attr-content">yes</span>" /&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e101">param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">knowledge-base</span>" <span class="xmlverb-attr-name">tunnel</span>="<span class="xmlverb-attr-content">yes</span>" /&gt;<span class="xmlverb-text"><br></br>
         </span>&lt;!--<span class="xmlverb-comment"> &lt;param name="ontologies" required="yes"/&gt; </span>--&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e105">param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">ontologies</span>" <span class="xmlverb-attr-name">required</span>="<span class="xmlverb-attr-content">no</span>" /&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e107">param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">mmt</span>" <span class="xmlverb-attr-name">tunnel</span>="<span class="xmlverb-attr-content">yes</span>" /&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;!--<span class="xmlverb-comment"> TODO does this work?  In generic.xsl we use<br></br>
             instance of document-node() </span>--&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e111">param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">use-document-uri</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">not($use-root-xmlid) and self::node() = /</span>" /&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e114">param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">process-next</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">*|@*</span>" /&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e116">param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">blank-node</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">false()</span>" /&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;!--<span class="xmlverb-comment"> Check if we can at all generate a URI for the current element </span>--&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e120">if</a></span> <span class="xmlverb-attr-name">test</span>="<span class="xmlverb-attr-content">($mmt and @name) or $use-document-uri or @xml:id</span>"&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e122">call-template</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">krextor:create-resource</span>"&gt;<span class="xmlverb-text"><br></br>
                </span>&lt;<span class="xmlverb-element-name"><a name="d43e124">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">properties</span>"&gt;<span class="xmlverb-text"><br></br>
                    </span>&lt;<span class="xmlverb-element-name"><a name="d43e126">if</a></span> <span class="xmlverb-attr-name">test</span>="<span class="xmlverb-attr-content">$formality-degree</span>"&gt;<span class="xmlverb-text"><br></br>
                        </span>&lt;<span class="xmlverb-element-nsprefix">krextor</span>:<span class="xmlverb-element-name"><a name="d43e128">property</a></span> <span class="xmlverb-attr-name">uri</span>="<span class="xmlverb-attr-content">http://omdoc.org/ontology#formalityDegree</span>" <span class="xmlverb-attr-name">object</span>="<span class="xmlverb-attr-content">{$formality-degree}</span>" /&gt;<span class="xmlverb-text"><br></br>
                    </span>&lt;/<span class="xmlverb-element-name">if</span>&gt;<span class="xmlverb-text"><br></br>
                    </span>&lt;<span class="xmlverb-element-name"><a name="d43e131">copy-of</a></span> <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">$properties</span>" /&gt;<span class="xmlverb-text"><br></br>
                </span>&lt;/<span class="xmlverb-element-name">with-param</span>&gt;<span class="xmlverb-text"><br></br>
                </span>&lt;<span class="xmlverb-element-name"><a name="d43e134">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">type</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">$type</span>" /&gt;<span class="xmlverb-text"><br></br>
                </span>&lt;<span class="xmlverb-element-name"><a name="d43e136">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">blank-node</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">$blank-node</span>" /&gt;<span class="xmlverb-text"><br></br>
                </span>&lt;<span class="xmlverb-element-name"><a name="d43e138">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">process-next</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">$process-next</span>" /&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;/<span class="xmlverb-element-name">call-template</span>&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;/<span class="xmlverb-element-name">if</span>&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;/<span class="xmlverb-element-name">template</span>&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span><div class="xd">

    &lt;<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name"><a name="d43e143">doc</a></span>&gt;<span class="xmlverb-text">Converts a list of symbol names into a list of the URIs of the corresponding symbol elements</span>&lt;/<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name">doc</span>&gt;</div><span class="xmlverb-text"><br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e146">function</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">omdoc:symbol-uris</span>" <span class="xmlverb-attr-name">as</span>="<span class="xmlverb-attr-content">xs:string*</span>"&gt;<span class="xmlverb-text"><br></br>
      </span>&lt;<span class="xmlverb-element-name"><a name="d43e148">param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">node</span>" <span class="xmlverb-attr-name">as</span>="<span class="xmlverb-attr-content">node()</span>" /&gt;<span class="xmlverb-text"><br></br>
      </span>&lt;!--<span class="xmlverb-comment"> TODO MMT URIs not yet supported; fix this together with the<br></br>
           improved URI generation, https://trac.kwarc.info/krextor/ticket/16 </span>--&gt;<span class="xmlverb-text"><br></br>
      </span>&lt;<span class="xmlverb-element-name"><a name="d43e152">value-of</a></span> <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">for $id in $node/ancestor::theory[1]// symbol[@name = tokenize($node, '\s+')]/@xml:id return concat('#', $id)</span>" /&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;/<span class="xmlverb-element-name">function</span>&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e155">function</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">omdoc:symbol-uri</span>" <span class="xmlverb-attr-name">as</span>="<span class="xmlverb-attr-content">xs:string?</span>"&gt;<span class="xmlverb-text"><br></br>
      </span>&lt;<span class="xmlverb-element-name"><a name="d43e157">param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">node</span>" <span class="xmlverb-attr-name">as</span>="<span class="xmlverb-attr-content">node()</span>" /&gt;<span class="xmlverb-text"><br></br>
      </span>&lt;<span class="xmlverb-element-name"><a name="d43e159">value-of</a></span> <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">concat('#', $node/ancestor::theory[1]//symbol[@name eq $node]/@xml:id)</span>" /&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;/<span class="xmlverb-element-name">function</span>&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span>&lt;!--<span class="xmlverb-comment"> TODO: There can also be @for for the rhetorical types but it's not yet completely clear where<br></br>
    the @for should point to and how to model it in the ontology. </span>--&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span><div class="xd">

    &lt;<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name"><a name="d43e164">doc</a></span>&gt;<span class="xmlverb-text">Some SALT rhetorical block types (usable everywhere)</span>&lt;/<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name">doc</span>&gt;</div><span class="xmlverb-text"><br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e168">variable</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">salt-rhetorical-block-types</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'introduction', 'background', 'motivation', 'scenario', 'contribution', 'evaluation', 'results', 'discussion', 'conclusion'</span>" /&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span><div class="xd">

    &lt;<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name"><a name="d43e170">doc</a></span>&gt;<span class="xmlverb-text">All SALT rhetorical block types (usable only on top level)</span>&lt;/<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name">doc</span>&gt;</div><span class="xmlverb-text"><br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e173">variable</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">salt-rhetorical-block-types-all</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">$salt-rhetorical-block-types, 'abstract', 'entities'</span>" /&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span><div class="xd">

    &lt;<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name"><a name="d43e175">doc</a></span>&gt;<span class="xmlverb-text">SALT RST-like rhetorical relation types</span>&lt;/<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name">doc</span>&gt;</div><span class="xmlverb-text"><br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e178">variable</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">salt-rhetorical-relation-types</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'antithesis', 'circumstance', 'concession', 'condition', 'evidence', 'means', 'preparation', 'purpose', 'cause', 'consequence', 'elaboration', 'restatement', 'solutionhood'</span>" /&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span><div class="xd">

    &lt;<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name"><a name="d43e180">doc</a></span>&gt;<span class="xmlverb-text">OMDoc assertion types</span>&lt;/<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name">doc</span>&gt;</div><span class="xmlverb-text"><br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e184">variable</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">omdoc-assertion-types</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'theorem', 'lemma', 'corollary', 'proposition', 'conjecture', 'false-conjecture', 'obligation', 'postulate', 'formula', 'assumption', 'rule'</span>" /&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span><div class="xd">

    &lt;<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name"><a name="d43e186">doc</a></span>&gt;<span class="xmlverb-text">OMDoc statement and assertion types</span>&lt;/<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name">doc</span>&gt;</div><span class="xmlverb-text"><br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e189">variable</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">omdoc-statement-types</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">$omdoc-assertion-types, 'axiom', 'definition', 'example', 'proof', 'assertion', 'rule', 'hypothesis', 'notation'</span>" /&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span><div class="xd">

    &lt;<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name"><a name="d43e191">doc</a></span>&gt;<span class="xmlverb-text">*—homeTheory→Theory</span>&lt;/<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name">doc</span>&gt;</div><span class="xmlverb-text"><br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e194">template</a></span> <span class="xmlverb-attr-name">match</span>="<span class="xmlverb-attr-content">omdoc:*/@theory</span>" <span class="xmlverb-attr-name">mode</span>="<span class="xmlverb-attr-content">krextor:main</span>"&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e196">call-template</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">krextor:add-uri-property</span>"&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e198">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">property</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'http://omdoc.org/ontology#homeTheory'</span>" /&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;/<span class="xmlverb-element-name">call-template</span>&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;/<span class="xmlverb-element-name">template</span>&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span><div class="xd">

    &lt;<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name"><a name="d43e202">doc</a></span>&gt;<span class="xmlverb-text">Document</span>&lt;/<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name">doc</span>&gt;</div><span class="xmlverb-text"><br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e206">template</a></span> <span class="xmlverb-attr-name">match</span>="<span class="xmlverb-attr-content">omdoc</span>" <span class="xmlverb-attr-name">mode</span>="<span class="xmlverb-attr-content">krextor:main</span>"&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e208">call-template</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">krextor:create-omdoc-resource</span>"&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e210">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">mmt</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">@version eq '1.6'</span>" <span class="xmlverb-attr-name">tunnel</span>="<span class="xmlverb-attr-content">yes</span>" /&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e212">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">type</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'http://omdoc.org/ontology#Document'</span>" /&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e214">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">ontologies</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'document'</span>" /&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;/<span class="xmlverb-element-name">call-template</span>&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;/<span class="xmlverb-element-name">template</span>&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span><div class="xd">

    &lt;<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name"><a name="d43e218">doc</a></span>&gt;<span class="xmlverb-text">DocumentUnit</span>&lt;/<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name">doc</span>&gt;</div><span class="xmlverb-text"><br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e221">template</a></span> <span class="xmlverb-attr-name">match</span>="<span class="xmlverb-attr-content">omgroup</span>" <span class="xmlverb-attr-name">mode</span>="<span class="xmlverb-attr-content">krextor:main</span>"&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e223">call-template</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">krextor:create-omdoc-resource</span>"&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;!--<span class="xmlverb-comment"> FIXME documentUnit, rhetoricalBlock? </span>--&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e227">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">type</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">if (@type = $salt-rhetorical-block-types-all) then concat('http://salt.semanticauthoring.org/onto/rhetorical-ontology#', krextor:dashes-to-camelcase(@type)) else 'http://omdoc.org/ontology#DocumentUnit'</span>" /&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e229">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">related-via-properties</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">if ($use-document-ontology) then if(parent::omdoc) then 'http://salt.semanticauthoring.org/onto/abstract-document-ontology#hasComposite' else 'http://salt.semanticauthoring.org/onto/abstract-document-ontology#hasPart' else ''</span>" <span class="xmlverb-attr-name">tunnel</span>="<span class="xmlverb-attr-content">yes</span>" /&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;/<span class="xmlverb-element-name">call-template</span>&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;/<span class="xmlverb-element-name">template</span>&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span><div class="xd">

    &lt;<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name"><a name="d43e233">doc</a></span>&gt;<span class="xmlverb-text">*—hasDirectPart→Reference</span>&lt;/<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name">doc</span>&gt;</div><span class="xmlverb-text"><br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e236">template</a></span> <span class="xmlverb-attr-name">match</span>="<span class="xmlverb-attr-content">ref</span>" <span class="xmlverb-attr-name">mode</span>="<span class="xmlverb-attr-content">krextor:main</span>"&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e238">call-template</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">krextor:create-omdoc-resource</span>"&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;!--<span class="xmlverb-comment"> FIXME documentUnit </span>--&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e242">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">type</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'http://omdoc.org/ontology#Reference'</span>" /&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e244">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">related-via-properties</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'http://omdoc.org/ontology#hasDirectPart'</span>" <span class="xmlverb-attr-name">tunnel</span>="<span class="xmlverb-attr-content">yes</span>" /&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;/<span class="xmlverb-element-name">call-template</span>&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;/<span class="xmlverb-element-name">template</span>&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span><div class="xd">

    &lt;<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name"><a name="d43e248">doc</a></span>&gt;<span class="xmlverb-text">Reference—hasReference→*</span>&lt;/<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name">doc</span>&gt;</div><span class="xmlverb-text"><br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e252">template</a></span> <span class="xmlverb-attr-name">match</span>="<span class="xmlverb-attr-content">ref/@xref</span>" <span class="xmlverb-attr-name">mode</span>="<span class="xmlverb-attr-content">krextor:main</span>"&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e254">call-template</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">krextor:add-uri-property</span>"&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e256">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">property</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'http://omdoc.org/ontology#hasReference'</span>" /&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;/<span class="xmlverb-element-name">call-template</span>&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;/<span class="xmlverb-element-name">template</span>&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span><div class="xd">

    &lt;<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name"><a name="d43e260">doc</a></span>&gt;<span class="xmlverb-text">Theory</span>&lt;/<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name">doc</span>&gt;</div><span class="xmlverb-text"><br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e263">template</a></span> <span class="xmlverb-attr-name">match</span>="<span class="xmlverb-attr-content">theory</span>" <span class="xmlverb-attr-name">mode</span>="<span class="xmlverb-attr-content">krextor:main</span>"&gt;<span class="xmlverb-text">        <br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e265">call-template</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">krextor:create-omdoc-resource</span>"&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;!--<span class="xmlverb-comment"> FIXME documentUnit, mathematicalBlock </span>--&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e269">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">related-via-properties</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">if (parent::theory) then 'http://omdoc.org/ontology#homeTheoryOf' else 'http://omdoc.org/ontology#hasDirectPart' , if ($use-document-ontology) then if (parent::omdoc) then 'http://salt.semanticauthoring.org/onto/abstract-document-ontology#hasComposite' else 'http://salt.semanticauthoring.org/onto/abstract-document-ontology#hasPart' else ''</span>" <span class="xmlverb-attr-name">tunnel</span>="<span class="xmlverb-attr-content">yes</span>" /&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e271">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">type</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'http://omdoc.org/ontology#Theory'</span>" /&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;/<span class="xmlverb-element-name">call-template</span>&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;!--<span class="xmlverb-comment"> TODO make this the home theory of any statement-level child<br></br>
        and any subtheory, which is not in an XIncluded or ref-included document<br></br>
        Probably use a separate mode for that, to be able to match e.g.<br></br>
        match="definition" mode="child" and generate containsDefinition from that,<br></br>
        instead of a generic contains relationship. </span>--&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;/<span class="xmlverb-element-name">template</span>&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span><div class="xd">

    &lt;<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name"><a name="d43e277">doc</a></span>&gt;<span class="xmlverb-text">Theory—metaTheory→Theory</span>&lt;/<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name">doc</span>&gt;</div><span class="xmlverb-text"><br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e280">template</a></span> <span class="xmlverb-attr-name">match</span>="<span class="xmlverb-attr-content">theory/@meta</span>" <span class="xmlverb-attr-name">mode</span>="<span class="xmlverb-attr-content">krextor:main</span>"&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e282">call-template</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">krextor:add-uri-property</span>"&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e284">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">property</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'http://omdoc.org/ontology#metaTheory'</span>" /&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;/<span class="xmlverb-element-name">call-template</span>&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;/<span class="xmlverb-element-name">template</span>&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span><div class="xd">

    &lt;<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name"><a name="d43e288">doc</a></span>&gt;<span class="xmlverb-text">a plain OMDoc 1.2 import without morphism</span>&lt;/<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name">doc</span>&gt;</div><span class="xmlverb-text"><br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e292">template</a></span> <span class="xmlverb-attr-name">match</span>="<span class="xmlverb-attr-content">imports[not(*)]</span>" <span class="xmlverb-attr-name">mode</span>="<span class="xmlverb-attr-content">krextor:main</span>"&gt;<span class="xmlverb-text"><br></br>
      </span>&lt;!--<span class="xmlverb-comment"> We can't directly match the @from attribute, as <br></br>
           is it not processed by the parent apply-templates </span>--&gt;<span class="xmlverb-text"><br></br>
      </span>&lt;<span class="xmlverb-element-name"><a name="d43e296">call-template</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">krextor:add-uri-property</span>"&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e298">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">property</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'http://omdoc.org/ontology#imports'</span>" /&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e300">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">object</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">@from</span>" /&gt;<span class="xmlverb-text"><br></br>
      </span>&lt;/<span class="xmlverb-element-name">call-template</span>&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;/<span class="xmlverb-element-name">template</span>&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span><div class="xd">

    &lt;<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name"><a name="d43e304">doc</a></span>&gt;<span class="xmlverb-text">An MMT (OMDoc 1.6) import, or an OMDoc 1.2 import with morphism</span>&lt;/<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name">doc</span>&gt;</div><span class="xmlverb-text"><br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e307">template</a></span> <span class="xmlverb-attr-name">match</span>="<span class="xmlverb-attr-content">import| imports[*]</span>" <span class="xmlverb-attr-name">mode</span>="<span class="xmlverb-attr-content">krextor:main</span>"&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e309">call-template</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">krextor:create-omdoc-resource</span>"&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;!--<span class="xmlverb-comment"> FIXME mathematicalBlock. Is it a document unit? </span>--&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e313">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">type</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'http://omdoc.org/ontology#Import'</span>" /&gt;<span class="xmlverb-text"><br></br>
                </span>&lt;<span class="xmlverb-element-name"><a name="d43e315">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">related-via-properties</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">if (parent::theory) then 'http://omdoc.org/ontology#homeTheoryOf' else 'http://omdoc.org/ontology#hasImport' , if ($use-document-ontology) then 'http://salt.semanticauthoring.org/onto/abstract-document-ontology#hasPart' else ''</span>" <span class="xmlverb-attr-name">tunnel</span>="<span class="xmlverb-attr-content">yes</span>" /&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;/<span class="xmlverb-element-name">call-template</span>&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;/<span class="xmlverb-element-name">template</span>&gt;<span class="xmlverb-text">    <br></br>
<br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e319">template</a></span> <span class="xmlverb-attr-name">match</span>="<span class="xmlverb-attr-content">import/@from| imports[*]/@from</span>" <span class="xmlverb-attr-name">mode</span>="<span class="xmlverb-attr-content">krextor:main</span>"&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e321">call-template</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">krextor:add-uri-property</span>"&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e323">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">property</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'http://omdoc.org/ontology#importsFrom'</span>" /&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;/<span class="xmlverb-element-name">call-template</span>&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;/<span class="xmlverb-element-name">template</span>&gt;<span class="xmlverb-text"><br></br>
        <br></br>
        <br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e327">template</a></span> <span class="xmlverb-attr-name">match</span>="<span class="xmlverb-attr-content">omtext/@verbalizes</span>" <span class="xmlverb-attr-name">mode</span>="<span class="xmlverb-attr-content">krextor:main</span>"&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e329">call-template</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">krextor:add-uri-property</span>"&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e331">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">object-is-list</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">true()</span>" /&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e333">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">property</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'http://omdoc.org/ontology#verbalizes'</span>" /&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;/<span class="xmlverb-element-name">call-template</span>&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;/<span class="xmlverb-element-name">template</span>&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e337">template</a></span> <span class="xmlverb-attr-name">match</span>="<span class="xmlverb-attr-content">FMP/@logic</span>" <span class="xmlverb-attr-name">mode</span>="<span class="xmlverb-attr-content">krextor:main</span>"&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e339">call-template</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">krextor:add-literal-property</span>"&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e341">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">property</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'http://omdoc.org/ontology#logic'</span>" /&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;/<span class="xmlverb-element-name">call-template</span>&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;/<span class="xmlverb-element-name">template</span>&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e346">template</a></span> <span class="xmlverb-attr-name">match</span>="<span class="xmlverb-attr-content">CMP/@xml:lang</span>" <span class="xmlverb-attr-name">mode</span>="<span class="xmlverb-attr-content">krextor:main</span>"&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e348">call-template</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">krextor:add-literal-property</span>"&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e350">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">property</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'http://purl.org/dc/elements/1.1/language'</span>" /&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;/<span class="xmlverb-element-name">call-template</span>&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;/<span class="xmlverb-element-name">template</span>&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e354">template</a></span> <span class="xmlverb-attr-name">match</span>="<span class="xmlverb-attr-content">om:OMOBJ//om:OMS</span>" <span class="xmlverb-attr-name">mode</span>="<span class="xmlverb-attr-content">krextor:main</span>"&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e356">call-template</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">krextor:add-uri-property</span>"&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e358">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">property</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'http://omdoc.org/ontology#usesSymbol'</span>" /&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;!--<span class="xmlverb-comment"> use the innermost cdbase attribute. At least the OMOBJ must have a cdbase attribute,<br></br>
            or otherwise the default is assumed </span>--&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e362">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">object</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">om:symbol-uri((ancestor-or-self::om:*/@cdbase)[last()], @cd, @name)</span>" /&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;/<span class="xmlverb-element-name">call-template</span>&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;/<span class="xmlverb-element-name">template</span>&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span>&lt;!--<span class="xmlverb-comment"> TODO: MMT imports: add Theory-hasImport-Import-importsFrom-Theory </span>--&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span>&lt;!--<span class="xmlverb-comment"> TODO adapt to further progress of the MMT (OMDoc 1.6) specification </span>--&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e370">template</a></span> <span class="xmlverb-attr-name">match</span>="<span class="xmlverb-attr-content">symbol[not(@role)]</span>" <span class="xmlverb-attr-name">mode</span>="<span class="xmlverb-attr-content">krextor:main</span>"&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e372">call-template</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">krextor:create-omdoc-resource</span>"&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;!--<span class="xmlverb-comment"> FIXME mathematicalBlock. Is it a document unit? </span>--&gt;<span class="xmlverb-text"><br></br>
                </span>&lt;<span class="xmlverb-element-name"><a name="d43e376">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">related-via-properties</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">if (parent::proof) then 'http://omdoc.org/ontology#hasStep' else if (parent::theory) then 'http://omdoc.org/ontology#homeTheoryOf' else 'http://omdoc.org/ontology#hasDirectPart' , if ($use-document-ontology) then 'http://salt.semanticauthoring.org/onto/abstract-document-ontology#hasPart' else ''</span>" <span class="xmlverb-attr-name">tunnel</span>="<span class="xmlverb-attr-content">yes</span>" /&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e378">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">type</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">if (parent::proof) then 'http://omdoc.org/ontology#ProofLocalSymbol' else 'http://omdoc.org/ontology#Symbol'</span>" /&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;/<span class="xmlverb-element-name">call-template</span>&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;/<span class="xmlverb-element-name">template</span>&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e382">template</a></span> <span class="xmlverb-attr-name">match</span>="<span class="xmlverb-attr-content">symbol/type</span>" <span class="xmlverb-attr-name">mode</span>="<span class="xmlverb-attr-content">krextor:main</span>"&gt;<span class="xmlverb-text"><br></br>
      </span>&lt;<span class="xmlverb-element-name"><a name="d43e384">call-template</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">krextor:create-omdoc-resource</span>"&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e386">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">related-via-properties</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'http://omdoc.org/ontology#hasDeclaredType'</span>" <span class="xmlverb-attr-name">tunnel</span>="<span class="xmlverb-attr-content">yes</span>" /&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e388">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">type</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'http://omdoc.org/ontology#DeclaredType'</span>" /&gt;<span class="xmlverb-text"><br></br>
      </span>&lt;/<span class="xmlverb-element-name">call-template</span>&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;/<span class="xmlverb-element-name">template</span>&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e393">template</a></span> <span class="xmlverb-attr-name">match</span>="<span class="xmlverb-attr-content">type[not(parent::symbol)]</span>" <span class="xmlverb-attr-name">mode</span>="<span class="xmlverb-attr-content">krextor:main</span>"&gt;<span class="xmlverb-text"><br></br>
      </span>&lt;<span class="xmlverb-element-name"><a name="d43e395">call-template</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">krextor:create-omdoc-resource</span>"&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;!--<span class="xmlverb-comment"> FIXME documentUnit, mathematicalBlock </span>--&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e399">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">related-via-properties</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">if (parent::theory) then 'http://omdoc.org/ontology#homeTheoryOf' else 'http://omdoc.org/ontology#hasDirectPart' , if ($use-document-ontology) then if (parent::omdoc) then 'http://salt.semanticauthoring.org/onto/abstract-document-ontology#hasComposite' else 'http://salt.semanticauthoring.org/onto/abstract-document-ontology#hasPart' else ''</span>" <span class="xmlverb-attr-name">tunnel</span>="<span class="xmlverb-attr-content">yes</span>" /&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e401">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">type</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">if (@just-by) then 'http://omdoc.org/ontology#AssertedType' else 'http://omdoc.org/ontology#DeclaredType'</span>" /&gt;<span class="xmlverb-text"><br></br>
      </span>&lt;/<span class="xmlverb-element-name">call-template</span>&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;/<span class="xmlverb-element-name">template</span>&gt;<span class="xmlverb-text"><br></br>
    <br></br>
    </span><div class="xd">

    &lt;<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name"><a name="d43e405">doc</a></span>&gt;<span class="xmlverb-text">Symbol—has{Declared,Asserted}Type→Type</span>&lt;/<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name">doc</span>&gt;</div><span class="xmlverb-text"><br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e408">template</a></span> <span class="xmlverb-attr-name">match</span>="<span class="xmlverb-attr-content">type/@for</span>" <span class="xmlverb-attr-name">mode</span>="<span class="xmlverb-attr-content">krextor:main</span>"&gt;<span class="xmlverb-text"><br></br>
      </span>&lt;<span class="xmlverb-element-name"><a name="d43e410">call-template</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">krextor:add-uri-property</span>"&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e412">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">property</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">if (../@just-by) then 'http://omdoc.org/ontology#hasAssertedType' else 'http://omdoc.org/ontology#hasDeclaredType'</span>" /&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e414">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">inverse</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">true()</span>" /&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e416">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">object</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">omdoc:symbol-uri(.)</span>" /&gt;<span class="xmlverb-text"><br></br>
      </span>&lt;/<span class="xmlverb-element-name">call-template</span>&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;/<span class="xmlverb-element-name">template</span>&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span><div class="xd">

    &lt;<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name"><a name="d43e420">doc</a></span>&gt;<span class="xmlverb-text">AssertedType—typeJustifiedBy→Assertion</span>&lt;/<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name">doc</span>&gt;</div><span class="xmlverb-text"><br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e423">template</a></span> <span class="xmlverb-attr-name">match</span>="<span class="xmlverb-attr-content">type/@just-by</span>" <span class="xmlverb-attr-name">mode</span>="<span class="xmlverb-attr-content">krextor:main</span>"&gt;<span class="xmlverb-text"><br></br>
      </span>&lt;<span class="xmlverb-element-name"><a name="d43e425">call-template</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">krextor:add-uri-property</span>"&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e427">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">property</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'http://omdoc.org/ontology#typeJustifiedBy'</span>" /&gt;<span class="xmlverb-text"><br></br>
      </span>&lt;/<span class="xmlverb-element-name">call-template</span>&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;/<span class="xmlverb-element-name">template</span>&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span>&lt;!--<span class="xmlverb-comment"> TODO adapt to further progress of the MMT (OMDoc 1.6) specification </span>--&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e434">template</a></span> <span class="xmlverb-attr-name">match</span>="<span class="xmlverb-attr-content">symbol[@role eq 'axiom']| axiom</span>" <span class="xmlverb-attr-name">mode</span>="<span class="xmlverb-attr-content">krextor:main</span>"&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;!--<span class="xmlverb-comment"> axiom/@for missing </span>--&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e438">call-template</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">krextor:create-omdoc-resource</span>"&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;!--<span class="xmlverb-comment"> FIXME documentUnit, mathematicalBlock (can contain CMPs) </span>--&gt;<span class="xmlverb-text"><br></br>
                </span>&lt;<span class="xmlverb-element-name"><a name="d43e442">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">related-via-properties</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">if (parent::proof) then 'http://omdoc.org/ontology#hasStep' else if (parent::theory) then 'http://omdoc.org/ontology#homeTheoryOf' else 'http://omdoc.org/ontology#hasDirectPart' , if ($use-document-ontology) then 'http://salt.semanticauthoring.org/onto/abstract-document-ontology#hasPart' else ''</span>" <span class="xmlverb-attr-name">tunnel</span>="<span class="xmlverb-attr-content">yes</span>" /&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e444">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">type</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'http://omdoc.org/ontology#Axiom'</span>" /&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e446">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">formality-degree</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'http://omdoc.org/ontology#Formal'</span>" /&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;/<span class="xmlverb-element-name">call-template</span>&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;/<span class="xmlverb-element-name">template</span>&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e450">template</a></span> <span class="xmlverb-attr-name">match</span>="<span class="xmlverb-attr-content">definition[@name or @xml:id]</span>" <span class="xmlverb-attr-name">mode</span>="<span class="xmlverb-attr-content">krextor:main</span>"&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e452">call-template</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">krextor:create-omdoc-resource</span>"&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;!--<span class="xmlverb-comment"> FIXME documentUnit, mathematicalBlock </span>--&gt;<span class="xmlverb-text"><br></br>
                </span>&lt;<span class="xmlverb-element-name"><a name="d43e456">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">related-via-properties</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">if (parent::proof) then 'http://omdoc.org/ontology#hasStep' else if (parent::theory) then 'http://omdoc.org/ontology#homeTheoryOf' else 'http://omdoc.org/ontology#hasDirectPart' , if ($use-document-ontology) then 'http://salt.semanticauthoring.org/onto/abstract-document-ontology#hasPart' else ''</span>" <span class="xmlverb-attr-name">tunnel</span>="<span class="xmlverb-attr-content">yes</span>" /&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e458">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">type</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">if (parent::proof) then 'http://omdoc.org/ontology#ProofLocalDefinition' else 'http://omdoc.org/ontology#Definition'</span>" /&gt;<span class="xmlverb-text"><br></br>
                </span>&lt;<span class="xmlverb-element-name"><a name="d43e460">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">formality-degree</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'http://omdoc.org/ontology#Formal'</span>" /&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;/<span class="xmlverb-element-name">call-template</span>&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;/<span class="xmlverb-element-name">template</span>&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e464">template</a></span> <span class="xmlverb-attr-name">match</span>="<span class="xmlverb-attr-content">definition/@for| omtext[@type eq 'definition']/@for</span>" <span class="xmlverb-attr-name">mode</span>="<span class="xmlverb-attr-content">krextor:main</span>"&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e466">call-template</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">krextor:add-uri-property</span>"&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e468">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">property</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'http://omdoc.org/ontology#defines'</span>" /&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e470">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">object</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">omdoc:symbol-uris(.)</span>" /&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e472">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">object-is-list</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">true()</span>" /&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;/<span class="xmlverb-element-name">call-template</span>&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;/<span class="xmlverb-element-name">template</span>&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e476">template</a></span> <span class="xmlverb-attr-name">match</span>="<span class="xmlverb-attr-content">example/@for| omtext[@type eq 'example']/@for</span>" <span class="xmlverb-attr-name">mode</span>="<span class="xmlverb-attr-content">krextor:main</span>"&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e478">call-template</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">krextor:add-uri-property</span>"&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e480">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">property</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'http://omdoc.org/ontology#exemplifies'</span>" /&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;/<span class="xmlverb-element-name">call-template</span>&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;/<span class="xmlverb-element-name">template</span>&gt;<span class="xmlverb-text"><br></br>
        <br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e484">template</a></span> <span class="xmlverb-attr-name">match</span>="<span class="xmlverb-attr-content">alternative</span>" <span class="xmlverb-attr-name">mode</span>="<span class="xmlverb-attr-content">krextor:main</span>"&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e486">call-template</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">krextor:create-omdoc-resource</span>"&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;!--<span class="xmlverb-comment"> FIXME documentUnit, mathematicalBlock </span>--&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e490">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">related-via-properties</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">if (parent::theory) then 'http://omdoc.org/ontology#homeTheoryOf' else 'http://omdoc.org/ontology#hasDirectPart' , if ($use-document-ontology) then if (parent::omdoc) then 'http://salt.semanticauthoring.org/onto/abstract-document-ontology#hasComposite' else 'http://salt.semanticauthoring.org/onto/abstract-document-ontology#hasPart' else ''</span>" <span class="xmlverb-attr-name">tunnel</span>="<span class="xmlverb-attr-content">yes</span>" /&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e492">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">type</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'http://omdoc.org/ontology#AlternativeDefinition'</span>" /&gt;<span class="xmlverb-text"><br></br>
                </span>&lt;<span class="xmlverb-element-name"><a name="d43e494">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">formality-degree</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'http://omdoc.org/ontology#Formal'</span>" /&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;/<span class="xmlverb-element-name">call-template</span>&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;/<span class="xmlverb-element-name">template</span>&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e498">template</a></span> <span class="xmlverb-attr-name">match</span>="<span class="xmlverb-attr-content">assertion</span>" <span class="xmlverb-attr-name">mode</span>="<span class="xmlverb-attr-content">krextor:main</span>"&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e500">call-template</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">krextor:create-omdoc-resource</span>"&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;!--<span class="xmlverb-comment"> FIXME documentUnit, mathematicalBlock </span>--&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e504">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">related-via-properties</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">if (parent::theory) then 'http://omdoc.org/ontology#homeTheoryOf' else 'http://omdoc.org/ontology#hasDirectPart' , if ($use-document-ontology) then if (parent::omdoc) then 'http://salt.semanticauthoring.org/onto/abstract-document-ontology#hasComposite' else 'http://salt.semanticauthoring.org/onto/abstract-document-ontology#hasPart' else ''</span>" <span class="xmlverb-attr-name">tunnel</span>="<span class="xmlverb-attr-content">yes</span>" /&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e506">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">type</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">concat('http://omdoc.org/ontology#', if (@type eq 'assumption') then 'AssumptionAssertion' else if (@type = $omdoc-assertion-types) then krextor:dashes-to-camelcase(@type) else 'Assertion')</span>" /&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e508">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">formality-degree</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'http://omdoc.org/ontology#Formal'</span>" /&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;/<span class="xmlverb-element-name">call-template</span>&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;/<span class="xmlverb-element-name">template</span>&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e513">template</a></span> <span class="xmlverb-attr-name">match</span>="<span class="xmlverb-attr-content">example</span>" <span class="xmlverb-attr-name">mode</span>="<span class="xmlverb-attr-content">krextor:main</span>"&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e515">call-template</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">krextor:create-omdoc-resource</span>"&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;!--<span class="xmlverb-comment"> FIXME documentUnit, mathematicalBlock </span>--&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e519">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">related-via-properties</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">if (parent::theory) then 'http://omdoc.org/ontology#homeTheoryOf' else 'http://omdoc.org/ontology#hasDirectPart' , if ($use-document-ontology) then if (parent::omdoc) then 'http://salt.semanticauthoring.org/onto/abstract-document-ontology#hasComposite' else 'http://salt.semanticauthoring.org/onto/abstract-document-ontology#hasPart' else ''</span>" <span class="xmlverb-attr-name">tunnel</span>="<span class="xmlverb-attr-content">yes</span>" /&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e521">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">type</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'http://omdoc.org/ontology#Example'</span>" /&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e523">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">formality-degree</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'http://omdoc.org/ontology#Formal'</span>" /&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;/<span class="xmlverb-element-name">call-template</span>&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;/<span class="xmlverb-element-name">template</span>&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e527">template</a></span> <span class="xmlverb-attr-name">match</span>="<span class="xmlverb-attr-content">notation</span>" <span class="xmlverb-attr-name">mode</span>="<span class="xmlverb-attr-content">krextor:main</span>"&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e529">call-template</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">krextor:create-omdoc-resource</span>"&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;!--<span class="xmlverb-comment"> FIXME documentUnit, mathematicalBlock </span>--&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e533">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">related-via-properties</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">if (parent::theory) then 'http://omdoc.org/ontology#homeTheoryOf' else 'http://omdoc.org/ontology#hasDirectPart' , if ($use-document-ontology) then if (parent::omdoc) then 'http://salt.semanticauthoring.org/onto/abstract-document-ontology#hasComposite' else 'http://salt.semanticauthoring.org/onto/abstract-document-ontology#hasPart' else ''</span>" <span class="xmlverb-attr-name">tunnel</span>="<span class="xmlverb-attr-content">yes</span>" /&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e535">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">type</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'http://omdoc.org/ontology#NotationDefinition'</span>" /&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e537">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">formality-degree</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'http://omdoc.org/ontology#Formal'</span>" /&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;/<span class="xmlverb-element-name">call-template</span>&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;/<span class="xmlverb-element-name">template</span>&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e541">template</a></span> <span class="xmlverb-attr-name">match</span>="<span class="xmlverb-attr-content">prototype[not(preceding-sibling::prototype)]</span>" <span class="xmlverb-attr-name">mode</span>="<span class="xmlverb-attr-content">krextor:main</span>"&gt;<span class="xmlverb-text"><br></br>
      </span>&lt;<span class="xmlverb-element-name"><a name="d43e543">variable</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">symbol</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">om:matched-symbol(.)</span>" /&gt;<span class="xmlverb-text"><br></br>
      </span>&lt;!--<span class="xmlverb-comment"> has attributes:<br></br>
           @cdbase: usually empty (defaults to theory's cdbase) in OMDoc<br></br>
           @cd: name of current theory, or empty?<br></br>
           @name: name of symbol<br></br>
           </span>--&gt;<span class="xmlverb-text"><br></br>
      </span>&lt;<span class="xmlverb-element-name"><a name="d43e547">call-template</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">krextor:add-uri-property</span>"&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;!--<span class="xmlverb-comment"> the enclosing notation is the subject </span>--&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e551">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">property</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'http://omdoc.org/ontology#rendersSymbol'</span>" /&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;!--<span class="xmlverb-comment"> http://trac.kwarc.info/krextor/ticket/82 </span>--&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e555">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">object</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'FIXME'</span>" /&gt;<span class="xmlverb-text"><br></br>
      </span>&lt;/<span class="xmlverb-element-name">call-template</span>&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;/<span class="xmlverb-element-name">template</span>&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e559">template</a></span> <span class="xmlverb-attr-name">match</span>="<span class="xmlverb-attr-content">proof| proofobject</span>" <span class="xmlverb-attr-name">mode</span>="<span class="xmlverb-attr-content">krextor:main</span>"&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e561">variable</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">nested</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">parent::method[parent::derive]</span>" /&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e563">call-template</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">krextor:create-omdoc-resource</span>"&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;!--<span class="xmlverb-comment"> FIXME documentUnit, mathematicalBlock </span>--&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e567">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">related-via-properties</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">if ($nested) then 'http://omdoc.org/ontology#stepJustifiedBySubProof' else if (parent::theory) then 'http://omdoc.org/ontology#homeTheoryOf' else 'http://omdoc.org/ontology#hasDirectPart', if ($use-document-ontology) then if (parent::omdoc) then 'http://salt.semanticauthoring.org/onto/abstract-document-ontology#hasComposite' else 'http://salt.semanticauthoring.org/onto/abstract-document-ontology#hasPart' else ''</span>" <span class="xmlverb-attr-name">tunnel</span>="<span class="xmlverb-attr-content">yes</span>" /&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e569">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">type</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">if ($nested) then 'http://omdoc.org/ontology#NestedProof' else 'http://omdoc.org/ontology#Proof'</span>" /&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e571">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">formality-degree</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">if (self::proof) then 'http://omdoc.org/ontology#Formal' else 'http://omdoc.org/ontology#Computerized'</span>" /&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;/<span class="xmlverb-element-name">call-template</span>&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;/<span class="xmlverb-element-name">template</span>&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e575">template</a></span> <span class="xmlverb-attr-name">match</span>="<span class="xmlverb-attr-content">proof/@for| omtext[@type eq 'proof']/@for</span>" <span class="xmlverb-attr-name">mode</span>="<span class="xmlverb-attr-content">krextor:main</span>"&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e577">call-template</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">krextor:add-uri-property</span>"&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e579">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">property</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'http://omdoc.org/ontology#proves'</span>" /&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;/<span class="xmlverb-element-name">call-template</span>&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;/<span class="xmlverb-element-name">template</span>&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span>&lt;!--<span class="xmlverb-comment">TODO omtext/@type eq 'assumption' may have the inductive attribute</span>--&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e586">template</a></span> <span class="xmlverb-attr-name">match</span>="<span class="xmlverb-attr-content">omtext</span>" <span class="xmlverb-attr-name">mode</span>="<span class="xmlverb-attr-content">krextor:main</span>"&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e588">variable</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">has-mathematical-type</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">@type = $omdoc-statement-types</span>" /&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e590">call-template</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">krextor:create-omdoc-resource</span>"&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;!--<span class="xmlverb-comment"> FIXME documentUnit, (mathematicalBlock|rhetoricalBlock)?<br></br>
            maybe split into multiple templates </span>--&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e594">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">related-via-properties</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">if (parent::theory and $has-mathematical-type) then 'http://omdoc.org/ontology#homeTheoryOf' else if (parent::proof) then 'http://omdoc.org/ontology#hasStep' else 'http://omdoc.org/ontology#hasDirectPart' , if ($use-document-ontology) then if (parent::omdoc) then 'http://salt.semanticauthoring.org/onto/abstract-document-ontology#hasComposite' else 'http://salt.semanticauthoring.org/onto/abstract-document-ontology#hasPart' else ''</span>" <span class="xmlverb-attr-name">tunnel</span>="<span class="xmlverb-attr-content">yes</span>" /&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e596">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">type</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">(: This case needs special treatment, as notation is a mathematical type :) if (@type eq 'notation') then 'http://omdoc.org/ontology#NotationDefinition' else if ($has-mathematical-type) then concat('http://omdoc.org/ontology#', krextor:dashes-to-camelcase(@type)) else if (@type = $salt-rhetorical-block-types) then concat('http://salt.semanticauthoring.org/onto/rhetorical-ontology#', krextor:dashes-to-camelcase(@type)) else if (@type eq 'derive') then 'http://omdoc.org/ontology#DerivationStep' else if (parent::proof) then 'http://omdoc.org/ontology#ProofText' else 'http://omdoc.org/ontology#Statement'</span>" /&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e598">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">formality-degree</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'http://omdoc.org/ontology#Informal'</span>" /&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;/<span class="xmlverb-element-name">call-template</span>&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;/<span class="xmlverb-element-name">template</span>&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e602">template</a></span> <span class="xmlverb-attr-name">match</span>="<span class="xmlverb-attr-content">CMP| FMP</span>" <span class="xmlverb-attr-name">mode</span>="<span class="xmlverb-attr-content">krextor:main</span>"&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e604">call-template</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">krextor:create-omdoc-resource</span>"&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;!--<span class="xmlverb-comment"> FIXME documentUnit, mathematicalBlock </span>--&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e608">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">related-via-properties</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'http://omdoc.org/ontology#hasProperty' , if ($use-document-ontology) then 'http://salt.semanticauthoring.org/onto/abstract-document-ontology#hasInformationChunk' else ''</span>" <span class="xmlverb-attr-name">tunnel</span>="<span class="xmlverb-attr-content">yes</span>" /&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e610">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">type</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'http://omdoc.org/ontology#Property'</span>" /&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e612">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">formality-degree</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">if (self::CMP) then 'http://omdoc.org/ontology#Informal' else 'http://omdoc.org/ontology#Formal'</span>" /&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e614">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">properties</span>"&gt;<span class="xmlverb-text"><br></br>
                </span>&lt;!--<span class="xmlverb-comment"> extract the full-text content of a CMP </span>--&gt;<span class="xmlverb-text"><br></br>
                </span>&lt;<span class="xmlverb-element-name"><a name="d43e618">if</a></span> <span class="xmlverb-attr-name">test</span>="<span class="xmlverb-attr-content">self::CMP</span>"&gt;<span class="xmlverb-text"><br></br>
                    </span>&lt;<span class="xmlverb-element-nsprefix">krextor</span>:<span class="xmlverb-element-name"><a name="d43e620">property</a></span> <span class="xmlverb-attr-name">uri</span>="<span class="xmlverb-attr-content">http://omdoc.org/ontology#hasText</span>"&gt;<span class="xmlverb-text"><br></br>
                        </span>&lt;<span class="xmlverb-element-name"><a name="d43e622">apply-templates</a></span> <span class="xmlverb-attr-name">mode</span>="<span class="xmlverb-attr-content">krextor:text</span>" /&gt;<span class="xmlverb-text"><br></br>
                    </span>&lt;/<span class="xmlverb-element-nsprefix">krextor</span>:<span class="xmlverb-element-name">property</span>&gt;<span class="xmlverb-text"><br></br>
                </span>&lt;/<span class="xmlverb-element-name">if</span>&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;/<span class="xmlverb-element-name">with-param</span>&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;/<span class="xmlverb-element-name">call-template</span>&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;/<span class="xmlverb-element-name">template</span>&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span>&lt;!--<span class="xmlverb-comment"> in full-text extraction (from CMPs), recurse into OMDoc elements </span>--&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e631">template</a></span> <span class="xmlverb-attr-name">match</span>="<span class="xmlverb-attr-content">*</span>" <span class="xmlverb-attr-name">mode</span>="<span class="xmlverb-attr-content">krextor:text</span>"&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e633">apply-templates</a></span> <span class="xmlverb-attr-name">mode</span>="<span class="xmlverb-attr-content">krextor:text</span>" /&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;/<span class="xmlverb-element-name">template</span>&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span>&lt;!--<span class="xmlverb-comment"> in full-text extraction, copy every text node </span>--&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e638">template</a></span> <span class="xmlverb-attr-name">match</span>="<span class="xmlverb-attr-content">text()</span>" <span class="xmlverb-attr-name">mode</span>="<span class="xmlverb-attr-content">krextor:text</span>"&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e640">value-of</a></span> <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">.</span>" /&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;/<span class="xmlverb-element-name">template</span>&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span>&lt;!--<span class="xmlverb-comment"> when extracting the full-text content of a CMP, we are not interested in <br></br>
         strings in mathematical objects (in OpenMath usually numbers, in Content <br></br>
         MathML also symbols and variable names) </span>--&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e646">template</a></span> <span class="xmlverb-attr-name">match</span>="<span class="xmlverb-attr-content">m:*|om:*</span>" <span class="xmlverb-attr-name">mode</span>="<span class="xmlverb-attr-content">krextor:text</span>" /&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span>&lt;!--<span class="xmlverb-comment"> FIXME is it right to match omtext[@type eq 'assumption'] here?? </span>--&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e650">template</a></span> <span class="xmlverb-attr-name">match</span>="<span class="xmlverb-attr-content">FMP/assumption| omtext[@type eq 'assumption']/@for</span>" <span class="xmlverb-attr-name">mode</span>="<span class="xmlverb-attr-content">krextor:main</span>"&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e652">call-template</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">krextor:create-omdoc-resource</span>"&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;!--<span class="xmlverb-comment"> FIXME mathematicalBlock </span>--&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e656">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">related-via-properties</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'http://omdoc.org/ontology#assumes'</span>" <span class="xmlverb-attr-name">tunnel</span>="<span class="xmlverb-attr-content">yes</span>" /&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e658">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">type</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'http://omdoc.org/ontology#Assumption'</span>" /&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;/<span class="xmlverb-element-name">call-template</span>&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;/<span class="xmlverb-element-name">template</span>&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e662">template</a></span> <span class="xmlverb-attr-name">match</span>="<span class="xmlverb-attr-content">FMP/conclusion</span>" <span class="xmlverb-attr-name">mode</span>="<span class="xmlverb-attr-content">krextor:main</span>"&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e664">call-template</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">krextor:create-omdoc-resource</span>"&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;!--<span class="xmlverb-comment"> FIXME mathematicalBlock </span>--&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e668">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">related-via-properties</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'http://omdoc.org/ontology#concludesWith'</span>" <span class="xmlverb-attr-name">tunnel</span>="<span class="xmlverb-attr-content">yes</span>" /&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e670">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">type</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'http://omdoc.org/ontology#Conclusion'</span>" /&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;/<span class="xmlverb-element-name">call-template</span>&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;/<span class="xmlverb-element-name">template</span>&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e674">template</a></span> <span class="xmlverb-attr-name">match</span>="<span class="xmlverb-attr-content">CMP//term[@role eq 'definiendum']</span>" <span class="xmlverb-attr-name">mode</span>="<span class="xmlverb-attr-content">krextor:main</span>"&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e676">call-template</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">krextor:add-uri-property</span>"&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e678">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">property</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'http://omdoc.org/ontology#defines'</span>" /&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e680">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">object</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">om:symbol-uri((ancestor-or-self::om:*/@cdbase)[last()], @cd, @name)</span>" /&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;/<span class="xmlverb-element-name">call-template</span>&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;/<span class="xmlverb-element-name">template</span>&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e684">template</a></span> <span class="xmlverb-attr-name">match</span>="<span class="xmlverb-attr-content">CMP//term[@role eq 'definiens']</span>" <span class="xmlverb-attr-name">mode</span>="<span class="xmlverb-attr-content">krextor:main</span>"&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e686">call-template</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">krextor:add-uri-property</span>"&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e688">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">property</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'http://omdoc.org/ontology#usesSymbol'</span>" /&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e690">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">object</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">om:symbol-uri((ancestor-or-self::om:*/@cdbase)[last()], @cd, @name)</span>" /&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;/<span class="xmlverb-element-name">call-template</span>&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;/<span class="xmlverb-element-name">template</span>&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e695">template</a></span> <span class="xmlverb-attr-name">match</span>="<span class="xmlverb-attr-content">phrase[@type eq 'nucleus']</span>" <span class="xmlverb-attr-name">mode</span>="<span class="xmlverb-attr-content">krextor:main</span>"&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;!--<span class="xmlverb-comment"> Here, we just create the resource.<br></br>
        As it can be used in multiple rhetorical relations, we do that in a second pass </span>--&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e699">call-template</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">krextor:create-omdoc-resource</span>"&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;!--<span class="xmlverb-comment"> FIXME rhetoricalBlock.  No documentUnit, as below InformationChunk level </span>--&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e703">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">type</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'http://salt.semanticauthoring.org/onto/rhetorical-ontology#Nucleus'</span>" /&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;/<span class="xmlverb-element-name">call-template</span>&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;/<span class="xmlverb-element-name">template</span>&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e707">template</a></span> <span class="xmlverb-attr-name">match</span>="<span class="xmlverb-attr-content">phrase[@type eq 'nucleus']</span>" <span class="xmlverb-attr-name">mode</span>="<span class="xmlverb-attr-content">second-pass</span>"&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e709">param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">_omdoc-second-pass</span>" <span class="xmlverb-attr-name">tunnel</span>="<span class="xmlverb-attr-content">yes</span>" /&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e711">call-template</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">krextor:create-omdoc-resource</span>"&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;!--<span class="xmlverb-comment"> Here, we do not actually create the resource but abuse that<br></br>
            template to create an additional link from the rhetorical relation<br></br>
            to it. </span>--&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e715">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">related-via-properties</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'http://omdoc.org/ontology#hasNucleus'</span>" <span class="xmlverb-attr-name">tunnel</span>="<span class="xmlverb-attr-content">yes</span>" /&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;/<span class="xmlverb-element-name">call-template</span>&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;/<span class="xmlverb-element-name">template</span>&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e719">template</a></span> <span class="xmlverb-attr-name">match</span>="<span class="xmlverb-attr-content">phrase[@type eq 'satellite']</span>" <span class="xmlverb-attr-name">mode</span>="<span class="xmlverb-attr-content">second-pass</span>"&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e721">call-template</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">krextor:create-omdoc-resource</span>"&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;!--<span class="xmlverb-comment"> FIXME rhetoricalBlock.  No documentUnit, as below InformationChunk level </span>--&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e725">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">related-via-properties</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'http://omdoc.org/ontology#hasSatellite'</span>" <span class="xmlverb-attr-name">tunnel</span>="<span class="xmlverb-attr-content">yes</span>" /&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e727">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">type</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'http://salt.semanticauthoring.org/onto/rhetorical-ontology#Satellite'</span>" /&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;/<span class="xmlverb-element-name">call-template</span>&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;/<span class="xmlverb-element-name">template</span>&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e731">template</a></span> <span class="xmlverb-attr-name">match</span>="<span class="xmlverb-attr-content">phrase[@type eq 'satellite']/@for</span>" <span class="xmlverb-attr-name">mode</span>="<span class="xmlverb-attr-content">second-pass</span>"&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e733">apply-templates</a></span> <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">document(.)</span>" <span class="xmlverb-attr-name">mode</span>="<span class="xmlverb-attr-content">second-pass</span>" /&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;/<span class="xmlverb-element-name">template</span>&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span>&lt;!--<span class="xmlverb-comment"> We start processing phrases and rhetorical relations here </span>--&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e738">template</a></span> <span class="xmlverb-attr-name">match</span>="<span class="xmlverb-attr-content">phrase[@type eq 'satellite']</span>" <span class="xmlverb-attr-name">mode</span>="<span class="xmlverb-attr-content">krextor:main</span>"&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e740">param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">_omdoc-second-pass</span>" <span class="xmlverb-attr-name">tunnel</span>="<span class="xmlverb-attr-content">yes</span>" /&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e742">choose</a></span>&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e744">when</a></span> <span class="xmlverb-attr-name">test</span>="<span class="xmlverb-attr-content">$_omdoc-second-pass</span>"&gt;<span class="xmlverb-text"><br></br>
                </span>&lt;<span class="xmlverb-element-name"><a name="d43e746">apply-templates</a></span> <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">.|@for</span>" <span class="xmlverb-attr-name">mode</span>="<span class="xmlverb-attr-content">second-pass</span>"&gt;<span class="xmlverb-text"><br></br>
                    </span>&lt;<span class="xmlverb-element-name"><a name="d43e748">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">_omdoc-second-pass</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">false()</span>" <span class="xmlverb-attr-name">tunnel</span>="<span class="xmlverb-attr-content">yes</span>" /&gt;<span class="xmlverb-text"><br></br>
                </span>&lt;/<span class="xmlverb-element-name">apply-templates</span>&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;/<span class="xmlverb-element-name">when</span>&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e752">otherwise</a></span>&gt;<span class="xmlverb-text"><br></br>
                </span>&lt;<span class="xmlverb-element-name"><a name="d43e754">call-template</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">krextor:create-omdoc-resource</span>"&gt;<span class="xmlverb-text"><br></br>
                    </span>&lt;!--<span class="xmlverb-comment"> FIXME rhetoricalBlock.  No documentUnit, as below InformationChunk level </span>--&gt;<span class="xmlverb-text"><br></br>
                    </span>&lt;<span class="xmlverb-element-name"><a name="d43e758">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">related-via-inverse-properties</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'http://salt.semanticauthoring.org/onto/rhetorical-ontology#partOfRhetoricalStructure'</span>" <span class="xmlverb-attr-name">tunnel</span>="<span class="xmlverb-attr-content">yes</span>" /&gt;<span class="xmlverb-text"><br></br>
                    </span>&lt;<span class="xmlverb-element-name"><a name="d43e760">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">type</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">concat('http://salt.semanticauthoring.org/onto/rhetorical-ontology#', if (@relation = $salt-rhetorical-relation-types) then krextor:dashes-to-camelcase(@relation) else 'RhetoricalRelation')</span>" /&gt;<span class="xmlverb-text"><br></br>
                    </span>&lt;<span class="xmlverb-element-name"><a name="d43e762">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">blank-node</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">true()</span>" /&gt;<span class="xmlverb-text"><br></br>
                    </span>&lt;<span class="xmlverb-element-name"><a name="d43e764">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">process-next</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">.</span>" /&gt;<span class="xmlverb-text"><br></br>
                    </span>&lt;<span class="xmlverb-element-name"><a name="d43e767">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">_omdoc-second-pass</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">true()</span>" <span class="xmlverb-attr-name">tunnel</span>="<span class="xmlverb-attr-content">yes</span>" /&gt;<span class="xmlverb-text"><br></br>
                </span>&lt;/<span class="xmlverb-element-name">call-template</span>&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;/<span class="xmlverb-element-name">otherwise</span>&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;/<span class="xmlverb-element-name">choose</span>&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;/<span class="xmlverb-element-name">template</span>&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e774">template</a></span> <span class="xmlverb-attr-name">match</span>="<span class="xmlverb-attr-content">derive/method/premise</span>" <span class="xmlverb-attr-name">mode</span>="<span class="xmlverb-attr-content">krextor:main</span>"&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;!--<span class="xmlverb-comment"> TODO @rank </span>--&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;!--<span class="xmlverb-comment"> enforce the following template to be called </span>--&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e780">apply-templates</a></span> <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">@xref</span>" <span class="xmlverb-attr-name">mode</span>="<span class="xmlverb-attr-content">#current</span>" /&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;/<span class="xmlverb-element-name">template</span>&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e783">template</a></span> <span class="xmlverb-attr-name">match</span>="<span class="xmlverb-attr-content">derive/method/premise/@xref</span>" <span class="xmlverb-attr-name">mode</span>="<span class="xmlverb-attr-content">krextor:main</span>"&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e785">variable</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">target-is-proof-step</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">document(.)/ancestor::proof[1] is ancestor::proof[1]</span>" /&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e787">call-template</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">krextor:add-uri-property</span>"&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e789">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">property</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">if ($target-is-proof-step) then 'http://omdoc.org/ontology#stepJustifiedByPrecedingStep' else 'http://omdoc.org/ontology#stepExternallyJustifiedBy'</span>" /&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;!--<span class="xmlverb-comment">&lt;with-param name="formality-degree" select="'&amp;oo;Informal'"/&gt;</span>--&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;/<span class="xmlverb-element-name">call-template</span>&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;/<span class="xmlverb-element-name">template</span>&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e795">template</a></span> <span class="xmlverb-attr-name">match</span>="<span class="xmlverb-attr-content">derive[@type eq 'conclusion']</span>" <span class="xmlverb-attr-name">mode</span>="<span class="xmlverb-attr-content">krextor:main</span>"&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e797">call-template</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">krextor:create-omdoc-resource</span>"&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;!--<span class="xmlverb-comment"> FIXME documentUnit, mathematicalBlock </span>--&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e801">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">related-via-properties</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'http://omdoc.org/ontology#hasConclusion' , if ($use-document-ontology) then 'http://salt.semanticauthoring.org/onto/abstract-document-ontology#hasPart' else ''</span>" <span class="xmlverb-attr-name">tunnel</span>="<span class="xmlverb-attr-content">yes</span>" /&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e803">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">type</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'http://omdoc.org/ontology#DerivedConclusion'</span>" /&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;/<span class="xmlverb-element-name">call-template</span>&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;/<span class="xmlverb-element-name">template</span>&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e807">template</a></span> <span class="xmlverb-attr-name">match</span>="<span class="xmlverb-attr-content">derive[@type eq 'gap']</span>" <span class="xmlverb-attr-name">mode</span>="<span class="xmlverb-attr-content">krextor:main</span>"&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e809">call-template</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">krextor:create-omdoc-resource</span>"&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;!--<span class="xmlverb-comment"> FIXME documentUnit, mathematicalBlock </span>--&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e813">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">related-via-properties</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'http://omdoc.org/ontology#hasStep' , if ($use-document-ontology) then 'http://salt.semanticauthoring.org/onto/abstract-document-ontology#hasPart' else ''</span>" <span class="xmlverb-attr-name">tunnel</span>="<span class="xmlverb-attr-content">yes</span>" /&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e815">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">type</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'http://omdoc.org/ontology#Gap'</span>" /&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;/<span class="xmlverb-element-name">call-template</span>&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;/<span class="xmlverb-element-name">template</span>&gt;<span class="xmlverb-text"><br></br>
<br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e819">template</a></span> <span class="xmlverb-attr-name">match</span>="<span class="xmlverb-attr-content">derive[not(@type eq 'conclusion') and not(@type eq 'gap')]</span>" <span class="xmlverb-attr-name">mode</span>="<span class="xmlverb-attr-content">krextor:main</span>"&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e821">call-template</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">krextor:create-omdoc-resource</span>"&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;!--<span class="xmlverb-comment"> FIXME documentUnit, mathematicalBlock </span>--&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e825">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">related-via-properties</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'http://omdoc.org/ontology#hasStep' , if ($use-document-ontology) then 'http://salt.semanticauthoring.org/onto/abstract-document-ontology#hasPart' else ''</span>" <span class="xmlverb-attr-name">tunnel</span>="<span class="xmlverb-attr-content">yes</span>" /&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e827">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">type</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'http://omdoc.org/ontology#DerivationStep'</span>" /&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;/<span class="xmlverb-element-name">call-template</span>&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;/<span class="xmlverb-element-name">template</span>&gt;<span class="xmlverb-text"> <br></br>
<br></br>
    </span>&lt;<span class="xmlverb-element-name"><a name="d43e831">template</a></span> <span class="xmlverb-attr-name">match</span>="<span class="xmlverb-attr-content">hypothesis</span>" <span class="xmlverb-attr-name">mode</span>="<span class="xmlverb-attr-content">krextor:main</span>"&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;<span class="xmlverb-element-name"><a name="d43e833">call-template</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">krextor:create-omdoc-resource</span>"&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;!--<span class="xmlverb-comment"> FIXME documentUnit, mathematicalBlock </span>--&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e837">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">related-via-properties</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'http://omdoc.org/ontology#hasStep' , if ($use-document-ontology) then 'http://salt.semanticauthoring.org/onto/abstract-document-ontology#hasPart' else ''</span>" <span class="xmlverb-attr-name">tunnel</span>="<span class="xmlverb-attr-content">yes</span>" /&gt;<span class="xmlverb-text"><br></br>
            </span>&lt;<span class="xmlverb-element-name"><a name="d43e839">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">type</span>" <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">'http://omdoc.org/ontology#Hypothesis'</span>" /&gt;<span class="xmlverb-text"><br></br>
        </span>&lt;/<span class="xmlverb-element-name">call-template</span>&gt;<span class="xmlverb-text"><br></br>
    </span>&lt;/<span class="xmlverb-element-name">template</span>&gt;<span class="xmlverb-text"><br></br>
<br></br>
</span>&lt;/<span class="xmlverb-element-name">stylesheet</span>&gt;<br></br>
</div>
</tt><br></br><br></br><br></br><br></br><br></br><br></br><br></br><br></br><br></br><br></br><br></br><br></br><br></br><br></br><br></br><br></br><br></br><br></br><br></br><br></br><br></br><br></br><br></br><br></br><br></br><br></br><br></br><br></br><br></br><br></br><br></br><br></br><br></br><br></br><br></br><br></br><br></br><br></br>v
         </body></html>
